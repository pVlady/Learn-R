# Пакет `tibble`
Термин *tibble* относится к фрейму данных, представленныдх классом `tbl_df`.  
Этот класс реализован с целью переопределить поведение по умолчанию базовых объектов датафрейм и наследуется от классов `tbl` и `data.frame`.  
Класс имеет атрибуты `names` (названия столбцов)  и `row.names` (метки строк – этот атрибут добавлен для совместимости и использовать его не рекомендуется).

## Поведение объектов класса `tbl_df`
* символьные вектора не приводятся принудительно к типу факторов
* расширение векторов к длинне других векторов фрейма происходит только для векторов длиной 1 (т.к. в иныхх случаях расширение часто приводит к ошибкам)
* имена столбцов не изменяются и возвращаются атрибутом `names`. При создании _tibble_ названия столбцов контролируются аргаументом `.name_repair`.
* имена столбцов не заполняются (отсутствующие заполняются автоматически). Пустые и дублирующиеся имена столбцов категорически не рекомендуются.
* имена строк **не добавляются** и настоятельно не рекомендуются к использованию. Атрибут `row.names` добавлен только для совместимости, и только для запроса количества строк.
* `df[, j]` возвращает `tibble`, а не вектор; значение по умолчанию - `df[, j, drop = FALSE]`.

## Создание фреймов
#### Функция `tibble()`
```r
tibble(..., .rows = NULL, .name_repair = c("check_unique", "unique", "universal", "minimal"))
```
Аргументом `.rows` указывается число строк.  
Аргумент `.name_repair` контролирует заголовки столбцов:
* `minimal` — без проверки, кроме самого наличия имени столбца
* `unique` — имя должно быть уникальное и не пустое
* `check_unique` — имя должно быть уникальное
* `universal` — делает имена уникальными и синтетическими
 
#### Функция `tibble_row()`
```r
tibble_row(..., .name_repair = c("check_unique", "unique", "universal", "minimal") )
```
Cоздает фрейм с одной строкой. Векторные столбцы должны иметь длинну в один элемент, не векторные приводятся к типу список с одним элементом.

#### Функция `new_tibble()`
```r
new_tibble(x, ..., nrow = NULL, class = NULL, subclass = NULL)
```
Создает фрейм с минимальными проверками в угоду производительности.

#### Другие методы создания объектов tibble
```r
as_tibble(x, .rows, .name_repair)        ; преобразует фрейм или матрицу к типу tbl_df
as_tibble_row(x, .name_repair)           ; преобразует вектор x в объект tibble с одной строкой
as_tibble_col(x, column_name = "value")  ; преобразует вектор x в объект tibble с одним столбцом с названием value
```
Значения аргументов такие же, как и у функции `tibble()`.

#### Построчное создание фрейма: функция `tribble()`
```r
tribble(                     ; наглядно создает tibble строка за строкой
  ~a, ~b, ~c,                ; заголовки столбцов
  1, "2000-01-01", "1.5"
) %>%
  dplyr::mutate(
    dplyr::across(a, as.integer),
    dplyr::across(b, as.Date)
  )
```
#### Построчное создание матрицы: функция `frame_matrix()`
```r
frame_matrix(
  ~col1, ~col2,
  1,     3,
  5,     2
)
```

## Вывод на экран
```r
print(as_tibble(mtcars), n = 3, width = 50)            ; указывается число строк и ширина таблицы в сиимволах
view(as_tibble(mtcars), title = 'Date frame', n = 10)  ; вывод фрейма в отдельное окно
```

## Изменение объектов `tibble`
#### Функция `add_row()`
```r
add_row(.data, ..., .before = NULL, .after = NULL)
```
Добавляет новую строку во фрейм данных.  
`.before`, `.after` – индекс строки куда нужно добавить новую строку (по умолчанию добавляется в конец)

#### Функция `add_column()`
```r
add_column(.data,...,.before = NULL,.after = NULL,.name_repair = c("check_unique", "unique", "universal", "minimal"))
```
Добавляет один или несколько столбцов во фрейм данных.  
`.before`, `.after` – индекс или имя столбца, где нужно добавить новый столбец;  
`.name_repair` – аналогичен используемым в функции `tibble()`.

#### Функция `rowid_to_column()`
```r
rowid_to_column(.data, var = "rowid")
```
Добавляет столбец с идентификатором и **удаляет** все имена строк.

## Создание векторов для столбцов Tibble
Пакет имеет функции для создания числовых и символьных векторов с возможностью форматирования их значений.
```r
num(x,                  ; числовой вектор
    sigfig,             ; количество значащих цифр (не комбинируется с digits)
    digits,             ; количество отображаемых цифр после запятой (не комбинируется с sigfig)
    label,              ; метка столбца (если не указать , отображается тип)
    scale,              ; множитель применяемый перед отображением
    notation)           ; нотация отображения: fit - десятичная (если число цифр не более 13), dec - десятичная (е зависит от длины числа), sci - научная, ...
char(x, ...,            ; символьный вектор
     min_chars = NULL,  ; минимальная ширина, выделяемая для этого столбца (по умолчанию равна 15)
     shorten            ; тип сокращения: back - многоточие в конце (по умолчанию), front - многоточие спереди, mid - многоточие в середине, abbreviate - использование аббревиатуры
lst(...)                ; создает список с последовательным определением компонентов и автоматической генерацией отсутствующих имен (этот список можно использовать для создания tibble)
```

## Другие функции пакета
```r
is_tibble(x)                ; является ли x объектом tibble
validate_tibble(x)          ; проверка объекта tibble на равенство длин векторов-столбцов и наличия их названия (при неудаче, генерирует исключение)
enframe(x, name = "name",   ; преобразует именованные атомарные векторы или списки в фреймы данных с одним или двумя столбцами – name, value - имена столбцов, в которых хранятся имена и значения
           value = "value") ;   (для списка результатом будет вложенный tibble со столбцом типа list)
deframe(x)                  ; преобразует фрейм из двух столбцов в именованный вектор или список (первый столбец — имена, второй -  значения)
```

## References
[О tibble](https://bestpractices.netlify.app/r_language/tidyverse/tibble_tidyverse)  
